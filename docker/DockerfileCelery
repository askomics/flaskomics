FROM alpine:3.9

MAINTAINER "Xavier Garnier <xavier.garnier@irisa.fr>"

COPY . /askomics
WORKDIR /askomics

ENV DEPMODE="prod"

RUN apk add --no-cache \
    gcc g++ \
    python3 python3-dev \
    git bash && \
    /askomics/install.sh -i js && \
    apk del gcc g++ && \
    rm -rf /var/cache/apk/* && \
    rm -rf /root/.cache/* && \
    rm -rf /root/.npm/*

ENTRYPOINT /askomics/run_celery.sh -d ${DEPMODE}

FROM alpine:3.9

MAINTAINER "Xavier Garnier <xavier.garnier@irisa.fr>"

COPY . /askomics
WORKDIR /askomics

ENV DEPMODE="prod"

RUN apk add --no-cache \
    gcc g++ make \
    zlib-dev libzip-dev bzip2-dev xz-dev \
    python3 python3-dev \
    py3-numpy \
    git bash && \
    rm -f config/askomics.ini && \
    /askomics/install.sh -i js && \
    apk del gcc g++ make zlib-dev libzip-dev bzip2-dev xz-dev && \
    rm -rf /var/cache/apk/* && \
    rm -rf /root/.cache/* && \
    rm -rf /root/.npm/*

ENTRYPOINT /askomics/run_celery.sh -d ${DEPMODE}
